<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile</title>
</head>
<body>
    <h1>Welcome, {{ current_user.username }}!</h1>
    <p>You are logged in as: <strong>{{ current_user.role|capitalize }}</strong></p>

    <form method="POST" enctype="multipart/form-data">
    
    <div style="margin-bottom: 1rem;">
        <label for="pfp">Profile Picture</label>

        {% if profile and profile.pfp %}
            <div style="margin: 10px 0;">
                <img src="{{ url_for('static', filename='assets/pfp/' + profile.pfp) }}"
                     alt="Profile Picture"
                     style="width:120px; height:120px; object-fit:cover; border-radius:50%;">
            </div>
        {% endif %}

        <input type="file" name="pfp" id="pfp" accept="image/*">
    </div>
        
    <label>Full Name</label>
    <input type="text" name="full_name"
            value="{{ profile.full_name if profile else '' }}" required>

    <!-- Faculty dropdown -->
    <label>Faculty</label>
    <select name="faculty" id="faculty" required>
        {% for value, label in FACULTIES %}
        <option value="{{ value }}"
            {% if profile and profile.faculty == value %}selected{% endif %}>
            {{ label }}
        </option>
        {% endfor %}
    </select>

    <div id="programme-wrapper">
        <label>Programme</label>
        <select name="programme" id="programme" required>
            <option value="">-- Choose one --</option>
        </select>
    </div>

    <!-- Year -->
    <label>Year of Study</label>
    <select name="year" id="year" required>
        {% for y in [1,2,3,4] %}
        <option value="{{ y }}"
            {% if profile and profile.year == y %}selected{% endif %}>
            Year {{ y }}
        </option>
        {% endfor %}
    </select>

    <!-- Specialization -->
    <div id="specialization-wrapper" style="display: none;">
        <label>Specialization</label>
        <select name="specialization" id="specialization">
         <option value="">-- Choose one --</option>
        </select>
    </div>

    <!-- Bio -->
    <label>Bio</label>
    <textarea name="bio">{{ profile.bio if profile else '' }}</textarea>

    <button type="submit">Save Profile</button>
    </form>

    <a href="{{ url_for('project_list') }}">Go to Project Board</a><br>
    <a href="{{ url_for('forum') }}">Go to Discussion Board</a><br>
    <a href="{{ url_for('logout') }}">Press here to logout</a>

    <script>
        window.PROGRAMME_LABELS = {{ PROGRAMME_LABELS | tojson | safe }};
        window.SPECIALIZATION_CHOICES = {{ SPECIALIZATION_CHOICES | tojson | safe }};
        window.CURRENT_PROGRAMME = "{{ profile.programme if profile else '' }}";
        window.CURRENT_SPEC = "{{ profile.specialization if profile and profile.specialization else '' }}";
    </script>
    <script src="{{ url_for('static', filename='js/studentsetup.js') }}"></script>
</body>
</html>