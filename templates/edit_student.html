<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Edit Student Profile</title>

    <!-- base + edit styles + bg + darkmode -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/edit.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/sub-hex-bg.css') }}">
    <script src="{{ url_for('static', filename='js/darkmode.js') }}"></script>
</head>
<body>
    <button class="theme-toggle" id="themeToggle" title="Toggle dark mode">üåô</button>

    <div class="shell">

        <!-- HEADER PANEL (like request page) -->
        <div class="panel page-header">
            <div class="page-header-row">
                <div>
                    <h1 class="page-title">Edit Profile</h1>
                    <p class="muted">
                        Update your student details so mentors and teammates can know you better.
                    </p>
                </div>

                <a href="{{ url_for('dashboard') }}" class="pill-text pill-text-blue">‚Üê Back to Dashboard</a>
            </div>
        </div>

        <!-- MAIN EDIT PANEL: left = account + pfp, right = form -->
        <div class="panel edit-panel">
            <!-- LEFT COLUMN -->
            <div class="profile-side">
                <div class="pfp-block">
                    {% if profile and profile.pfp %}
                        <img src="{{ url_for('static', filename='uploads/pfp/' + profile.pfp) }}"
                            alt="Profile Picture">
                    {% else %}
                        <img src="{{ url_for('static', filename='uploads/pfp/default_pfp.png') }}"
                            alt="Profile Picture">
                    {% endif %}
                </div>

                <div class="form-group">
                    <label>Username</label>
                    <input type="text" class="readonly-field"
                        value="{{ current_user.username }}" disabled>
                </div>

                <div class="form-group">
                    <label>Email</label>
                    <input type="email" class="readonly-field"
                        value="{{ current_user.email }}" disabled>
                </div>

                <div class="form-group pfp-form">
                    <label for="pfp">Upload profile picture</label>
                    <input type="file" name="pfp" id="pfp" accept="image/*" form="student-edit-form">
                </div>
            </div>

            <!-- RIGHT COLUMN -->
            <div class="form-side">
                <form method="POST" enctype="multipart/form-data"
                    id="student-edit-form" class="edit-form">

                    <!-- Full name -->
                    <div class="form-group">
                        <label for="full_name">Full Name</label>
                        <input type="text" id="full_name" name="full_name"
                            value="{{ profile.full_name if profile else '' }}" required>
                    </div>

                    <!-- Faculty -->
                    <div class="form-group">
                        <label for="faculty">Faculty</label>
                        <select name="faculty" id="faculty" required>
                            {% for value, label in FACULTIES %}
                                <option value="{{ value }}"
                                    {% if profile and profile.faculty == value %}selected{% endif %}>
                                    {{ label }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Programme -->
                    <div class="form-group" id="programme-wrapper">
                        <label for="programme">Programme</label>
                        <select name="programme" id="programme" required>
                            <option value="">-- Choose one --</option>
                        </select>
                    </div>

                    <!-- Year -->
                    <div class="form-group">
                        <label for="year">Year of Study</label>
                        <select name="year" id="year" required>
                            {% for y in [1,2,3,4] %}
                                <option value="{{ y }}"
                                    {% if profile and profile.year == y %}selected{% endif %}>
                                    Year {{ y }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Specialization -->
                    <div class="form-group" id="specialization-wrapper" style="display:none;">
                        <label for="specialization">Specialization</label>
                        <select name="specialization" id="specialization">
                            <option value="">-- Choose one --</option>
                        </select>
                    </div>

                    <!-- Bio -->
                    <div class="form-group">
                        <label for="bio">Bio</label>
                        <textarea name="bio" id="bio"
                                placeholder="Tell others about your interests, skills, or goals‚Ä¶">{{ profile.bio if profile else '' }}</textarea>
                    </div>

                    <!-- Submit -->
                    <button type="submit" class="btn-save">Save Profile</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        window.PROGRAMME_LABELS = {{ PROGRAMME_LABELS | tojson | safe }};
        window.SPECIALIZATION_CHOICES = {{ SPECIALIZATION_CHOICES | tojson | safe }};
        window.CURRENT_PROGRAMME = "{{ profile.programme if profile else '' }}";
        window.CURRENT_SPEC = "{{ profile.specialization if profile and profile.specialization else '' }}";
    </script>
    <script src="{{ url_for('static', filename='js/studentsetup.js') }}"></script>
</body>
</html>
