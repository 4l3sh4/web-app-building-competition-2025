<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Student Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/sub-hex-bg.css') }}">
    <script src="{{ url_for('static', filename='js/darkmode.js') }}"></script>
</head>
<body class="sub-hex-bg">
<button class="theme-toggle" id="themeToggle" title="Toggle dark mode">üåô</button>

<div class="shell">

    <!-- HEADER PANEL -->
    <div class="panel page-header">
        <div class="page-header-row">
            <div>
                <h1 class="page-title">Student Dashboard</h1>
                <p class="muted">
                    See your projects, mentorship requests, and quick links in one place.
                </p>
            </div>
            <a href="{{ url_for('home') }}" class="back-link">‚Üê Back to Home</a>
        </div>
    </div>

    <!-- GRID: LEFT main / RIGHT side -->
    <div class="dashboard-grid">

        <!-- LEFT COLUMN -->
        <div class="dashboard-main">

            <!-- SUMMARY CARD -->
            <div class="panel summary-panel">
                <div class="summary-row">
                    {% set pfp_filename = student_profile.pfp if student_profile.pfp else 'default_pfp.png' %}
                    <div class="summary-pfp-wrap">
                        <img src="{{ url_for('static', filename='uploads/pfp/' ~ pfp_filename) }}"
                             alt="Profile Picture"
                             class="summary-pfp">
                    </div>

                    <div class="summary-main">
                        <div class="summary-name-row">
                            <div class="summary-name">
                                {{ student_profile.full_name }}
                            </div>
                            <span class="role-tag student-tag">STUDENT</span>
                        </div>

                        <div class="summary-subtext">
                            {{ student_profile.faculty|upper }} | Year {{ student_profile.year }} Student<br>
                            {{ programme_full }}
                            {% if specialization_full %}
                                ¬∑ {{ specialization_full }}
                            {% endif %}
                        </div>

                        <div class="summary-links">
                            {% if student_profile.github_profile %}
                                <a href="{{ student_profile.github_profile }}"
                                target="_blank"
                                class="link-primary">
                                    GitHub ‚Üí
                                </a>
                            {% endif %}

                            {% if student_profile.linkedin_profile %}
                                {% if student_profile.github_profile %} ¬∑ {% endif %}
                                <a href="{{ student_profile.linkedin_profile }}"
                                target="_blank"
                                class="link-primary">
                                    LinkedIn ‚Üí
                                </a>
                            {% endif %}
                        </div>
                    </div>

                    <div class="summary-actions">
                        <a href="{{ url_for('edit_student_profile') }}" class="btn-main">
                            Edit Profile
                        </a>
                    </div>
                </div>
            </div>

            <!-- ABOUT ME -->
            <div class="panel">
                <div class="section-title">About Me</div>
                <p class="section-body">
                    {% if student_profile.bio %}
                        {{ student_profile.bio }}
                    {% else %}
                        You haven't added a bio yet. Tell mentors and teammates more about yourself!
                    {% endif %}
                </p>
            </div>
            <!-- MY PROJECTS -->
            <div class="panel">
                <div class="section-title">My Projects</div>

                {% if my_projects and my_projects|length > 0 %}
                    <ol class="item-list simple-list">
                        {% for project in my_projects %}
                            {% set join_count = join_counts_by_project.get(project.id, 0) %}
                            <li class="project-row">
                                <div class="project-main">
                                    <span class="item-index">{{ loop.index }}.</span>
                                    <a href="{{ url_for('project_detail', project_id=project.id) }}"
                                    class="item-title link-primary">
                                        {{ project.title }}
                                    </a>
                                    <span class="item-meta">‚Äî {{ project.project_type }}</span>
                                </div>

                                <div class="project-tags">
                                    {% if join_count > 0 %}
                                        <a href="{{ url_for('manage_project_requests', project_id=project.id) }}"
                                        class="pill-join">
                                            Join Requests ({{ join_count }})
                                        </a>
                                    {% endif %}
                                    {% if unread_chat_by_project.get(project.id) %}
                                        <a href="{{ url_for('project_chat', project_id=project.id) }}" class="pill-chat">New Chat</a>
                                    {% endif %}
                                </div>
                            </li>
                        {% endfor %}
                    </ol>
                {% else %}
                    <p class="muted section-body">
                        You haven‚Äôt created any projects yet.
                    </p>
                {% endif %}
            </div>


            <!-- MY MENTORSHIP REQUESTS -->
            <div class="panel">
                <div class="section-title">My Mentorship Requests</div>

                {% if mentorship_requests and mentorship_requests|length > 0 %}
                    <ol class="request-list">
                        {% for req in mentorship_requests %}
                            <li class="request-row">
                                <!-- 1) index -->
                                <span class="item-index">{{ loop.index }}.</span>

                                <!-- 2) Mentor ‚Äì Title (title clickable to review page) -->
                                <div class="request-main">
                                    <a href="{{ url_for('view_user', user_id=req.mentor.id) }}"
                                    class="mentor-name link-primary">
                                        {{ req.mentor.mentor_profile.full_name
                                        if req.mentor.mentor_profile and req.mentor.mentor_profile.full_name
                                        else req.mentor.username }}
                                    </a>
                                    <span class="request-separator"> | </span>
                                    <a href="{{ url_for('review_mentor_request', req_id=req.id) }}"
                                    class="request-title link-primary">
                                        {{ req.title }}
                                    </a>
                                </div>

                                <!-- 3) status pill on the right -->
                                <span class="status-pill status-{{ req.status|lower() }}">
                                    {{ req.status }}
                                </span>

                                {% if req.status == 'Accepted' %}
                                    <a href="{{ url_for('mentor_chat', req_id=req.id) }}"
                                    class="btn-main" id="chat">
                                        Chat with Mentor
                                    </a>
                                {% endif %}

                            </li>
                        {% endfor %}
                    </ol>
                {% else %}
                    <p class="muted section-body">
                        You haven‚Äôt sent any mentorship requests yet.
                    </p>
                {% endif %}
            </div>

            <!-- MY THREADS -->
            <div class="panel">
                <div class="section-title">My Discussion Threads</div>

                {% if my_threads and my_threads|length > 0 %}
                    <ol class="item-list simple-list">
                        {% for thread in my_threads %}
                            <li>
                                <span class="item-index">{{ loop.index }}.</span>
                                <a href="{{ url_for('thread_detail', thread_id=thread.id) }}"
                                class="item-title link-primary">
                                    {{ thread.title }}
                                </a>
                                <span class="item-meta">‚Äî {{ thread.category }}</span>
                            </li>
                        {% endfor %}
                    </ol>
                {% else %}
                    <p class="muted section-body">
                        You haven‚Äôt created any threads yet.
                    </p>
                {% endif %}
            </div>

        </div>

        <!-- RIGHT COLUMN -->
        <div class="dashboard-side">
            <div class="panel">
                <div class="section-title">Quick Links</div>
                <p class="section-body">
                    <a href="{{ url_for('project_list') }}" class="link-primary">
                        Go to Project Board ‚Üí
                    </a><br>
                    <a href="{{ url_for('forum') }}" class="link-primary">
                        Go to Discussion Board ‚Üí
                    </a><br>
                    {% if is_self is defined and is_self %}
                        <a href="{{ url_for('logout') }}" class="link-primary">
                            Log out ‚Üí
                        </a>
                    {% endif %}
                </p>
            </div>
        </div>

    </div>

</div>
</body>
</html>